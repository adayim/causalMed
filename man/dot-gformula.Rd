% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/monte_g.r
\name{.gformula}
\alias{.gformula}
\title{Main calculation function}
\usage{
.gformula(
  data,
  id_var,
  base_vars,
  time_var,
  exposure,
  models,
  intervention,
  in_recode = NULL,
  out_recode = NULL,
  init_recode = NULL,
  mediation_type = c(NA, "N", "I"),
  mc_sample = 10000,
  return_fitted = FALSE,
  return_data = FALSE,
  progress_bar = TRUE,
  seed = mc_sample * 100
)
}
\arguments{
\item{data}{A \code{data.frame} (long format): one row per \code{id_var} per \code{time_var}.}

\item{id_var}{Character scalar. Subject identifier column name.}

\item{base_vars}{Character vector of time-fixed baseline covariates (may be empty).}

\item{time_var}{Character scalar. Time variable column name (ordered; integer/numeric).}

\item{exposure}{Character scalar. Exposure variable to intervene on (must be in \code{data}).}

\item{models}{A list of model specifications evaluated in temporal order. The order
appeared in the list should reflect the temporal ordering of the variables, in another
way data generation process. See \code{\link{spec_model}} for a recommended constructor.}

\item{intervention}{A named list specifying exposure interventions. Each
element is either \code{NULL} (the natural course) or a numeric/logical
vector whose length equals the number of unique time points in
\code{time_var}. For example,
\code{list(natural = NULL, always = c(1, 1, 1), never = c(0, 0, 0))}.
If \code{intervention} is \code{NULL}, only the natural course is
evaluated. If a \code{natural} arm is not provided, it is added
automatically and \code{ref_int} is set to \code{"natural"}.}

\item{in_recode}{Optional expression/function applied at the **start** of each time step
(e.g., entry-time functional forms). Should be defined with \code{\link{recodes}}. See Details.}

\item{out_recode}{Optional expression/function applied at the **end** of each time step
(e.g., create lags, cumulative counts). Should be defined with \code{\link{recodes}}. See Details.}

\item{init_recode}{Optional expression/function applied once at time 0 before the Monte Carlo loop
(e.g., initializing baseline-derived variables). Should be defined with \code{\link{recodes}}. See Details.}

\item{mediation_type}{Type of the mediation analysis, if the value is \code{NA}
no mediation analysis will be performed (default). It will be ignored if the intervention
 is not \code{NULL}}

\item{mc_sample}{Integer. Monte Carlo sample size used for simulation.
Default \code{nrow(data) * 100}.}

\item{return_fitted}{Return the fitted model (default is FALSE).}

\item{return_data}{Logical. If \code{TRUE}, return the stacked simulated data
(all interventions) including predicted outcomes; may be large. Default \code{FALSE}.}

\item{progress_bar}{Show progress bar (default).}

\item{seed}{Integer random seed for reproducibility. Default \code{12345}.}
}
\description{
This function will receive the parameters and fit model. After the model is fitted,
random samples will be drawn from the data and apply the intervention.
}
\keyword{internal}
